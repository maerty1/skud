# СКД - Система контроля доступа

Система контроля доступа на Go, замена PHP версии ND.

## Требования

- Go 1.19 или выше
- Windows/Linux/macOS

## Сборка

```bash
cd go
go build -o bin/skd.exe cmd/main.go
```

Для Linux/macOS:
```bash
go build -o bin/skd cmd/main.go
```

## Запуск

### Быстрый запуск (Windows)

**Вариант 1: Использовать готовый скрипт**
```bash
start.bat
```
или
```powershell
.\start.ps1
```

**Вариант 2: Запустить напрямую**
```bash
bin\skd.exe
```

### Linux/macOS
```bash
./bin/skd
```

### Если бинарник не собран

Сначала соберите проект:
```bash
go build -o bin/skd.exe cmd/main.go
```

Для Linux/macOS:
```bash
go build -o bin/skd cmd/main.go
```

## Конфигурация

Конфигурация может задаваться через:
1. **Переменные окружения** (рекомендуется для чувствительных данных)
2. **Файл config.json** (рядом с исполняемым файлом)
3. **Параметры командной строки** (формат: `ключ=значение`)

**Важно**: Чувствительные данные (IP адреса, пароли, пути) должны настраиваться через переменные окружения. См. `env.example` для примера.

### Быстрый старт

**1. Настройка переменных окружения (рекомендуется):**
```bash
# Скопируйте пример файла
cp env.example .env

# Отредактируйте .env и заполните значения:
# - HTTP_SERVICE_IP
# - HTTP_SERVICE_USER
# - HTTP_SERVICE_PASS
# - TERM_LIST_FILTER
# и другие
```

**2. Создать пример конфигурации (опционально):**
```bash
skd.exe -create-config
```

Это создаст файл `config.json` с настройками по умолчанию. Отредактируйте его под ваше окружение.

### Основные параметры

- `server.addr` / `server.port` - адрес и порт TCP сервера (по умолчанию: 0.0.0.0:8999)
- `web.addr` / `web.port` - адрес и порт Web интерфейса (по умолчанию: 0.0.0.0:8080)
- `web.enabled` - включить/выключить Web интерфейс (по умолчанию: true)
- `http_service.ip` - IP адрес 1C сервиса
- `term_list.filter` - фильтр терминалов (regex)

### Примеры

```bash
# Использовать config.json
skd.exe

# Указать другой файл конфигурации
skd.exe -config myconfig.json

# Переопределить параметры через командную строку
skd.exe server.port=9000 web.port=8081

# Показать справку
skd.exe -help
```

Подробнее см. [CONFIG.md](CONFIG.md)

## Web интерфейс

После запуска, Web интерфейс доступен по адресу:
- http://localhost:8080 (локально)
- http://<IP_адрес_сервера>:8080 (из сети, т.к. настроен на 0.0.0.0)

Функции:
- Мониторинг статуса системы
- Просмотр активных соединений и сессий
- Управление терминалами
- Просмотр логов в реальном времени
- Real-time обновления через SSE

## Логи

Логи сохраняются в директории `logs/`:
- `log_bin.txt` - основные логи
- `log_screen.txt` - логи для экрана

## Остановка

Нажмите `Ctrl+C` для graceful shutdown.

## Структура проекта

```
go/
├── cmd/
│   └── main.go          # Точка входа
├── internal/
│   ├── daemon/          # Основной daemon
│   ├── connection/       # Управление соединениями
│   ├── session/          # Управление сессиями
│   ├── protocols/       # Протоколы (POCKET, JSP, GAT, SPHINX)
│   ├── httpclient/      # HTTP клиент для 1C
│   ├── helios/           # Клиент Helios (камеры)
│   ├── logging/          # Система логирования
│   └── csvlogger/        # CSV логирование
├── pkg/
│   ├── types/            # Типы данных
│   └── utils/             # Утилиты
├── config/
│   └── config.go         # Конфигурация
└── bin/                   # Скомпилированные бинарники
```

## Протоколы

Поддерживаемые протоколы:
- **POCKET** - основной протокол для терминалов с биометрией
- **JSP** - JSON протокол для JavaScript терминалов
- **GAT** - стандартный протокол контроллеров доступа
- **SPHINX** - текстовый протокол для контроллеров Sphinx

## Интеграции

- **1C** - HTTP API для проверки доступа и отправки отчетов
- **Helios** - WebSocket клиент для распознавания лиц
- **CSV логирование** - структурированное логирование событий
